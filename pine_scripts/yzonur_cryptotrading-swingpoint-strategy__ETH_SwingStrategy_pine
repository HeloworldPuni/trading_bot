// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0
// Â© CryptoTrading Mid-Long Term Strategy

//@version=5
strategy("ETH Swing Strategy - EMA200 + RSI + BTC Korelasyon",
     overlay=true,
     initial_capital=10000,
     default_qty_type=strategy.percent_of_equity,
     default_qty_value=100,
     commission_type=strategy.commission.percent,
     commission_value=0.1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ AYARLAR (INPUTS) â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

grp_trend = "ğŸ“Š Trend Filtresi"
ema200_length = input.int(200, "EMA Periyodu", minval=50, maxval=300, group=grp_trend)
show_ema200 = input.bool(true, "EMA 200 Ã‡izgisini GÃ¶ster", group=grp_trend)

grp_rsi = "ğŸ“ˆ RSI AyarlarÄ±"
rsi_length = input.int(14, "RSI Periyodu", minval=7, maxval=21, group=grp_rsi)
rsi_trend_entry = input.int(40, "Trend Ä°Ã§i AlÄ±m RSI (<=)", minval=30, maxval=50, group=grp_rsi, tooltip="ETH daha volatil - BTC'den 5 puan dÃ¼ÅŸÃ¼k")
rsi_dip_entry = input.int(28, "Dip AvcÄ±sÄ± RSI (<=)", minval=15, maxval=35, group=grp_rsi, tooltip="ETH iÃ§in aÅŸÄ±rÄ± satÄ±m bÃ¶lgesi")
rsi_overbought = input.int(75, "AÅŸÄ±rÄ± AlÄ±m RSI (>=)", minval=65, maxval=85, group=grp_rsi)

grp_exit = "ğŸšª Ã‡Ä±kÄ±ÅŸ Stratejisi"
ema20_length = input.int(20, "Ã‡Ä±kÄ±ÅŸ EMA Periyodu", minval=10, maxval=50, group=grp_exit)
partial_exit_pct = input.int(50, "Ä°lk SatÄ±ÅŸ YÃ¼zdesi (%)", minval=25, maxval=75, group=grp_exit)
show_ema20 = input.bool(true, "EMA 20 Ã‡izgisini GÃ¶ster", group=grp_exit)

grp_btc = "â‚¿ BTC Korelasyon Filtresi"
enable_btc_filter = input.bool(true, "BTC Korelasyon Filtresini Aktif Et", group=grp_btc, tooltip="BTC EMA50 altÄ±ndaysa ETH alÄ±mÄ± yapma")
btc_symbol = input.symbol("BINANCE:BTCUSDT", "BTC SembolÃ¼", group=grp_btc)
btc_ema_length = input.int(50, "BTC EMA Periyodu", minval=20, maxval=100, group=grp_btc)

grp_dip = "ğŸ¯ Dip AvcÄ±sÄ± Modu"
enable_dip_hunter = input.bool(true, "Dip AvcÄ±sÄ± Modunu Aktif Et", group=grp_dip)

grp_alerts = "ğŸ”” Alarm AyarlarÄ±"
enable_alerts = input.bool(true, "AlarmlarÄ± Aktif Et", group=grp_alerts)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ HESAPLAMALAR â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ETH GÃ¶stergeleri
ema200 = ta.ema(close, ema200_length)
ema20 = ta.ema(close, ema20_length)
rsi = ta.rsi(close, rsi_length)

// BTC Verileri (Korelasyon iÃ§in)
btc_close = request.security(btc_symbol, timeframe.period, close)
btc_ema50 = request.security(btc_symbol, timeframe.period, ta.ema(close, btc_ema_length))

// Trend DurumlarÄ±
is_eth_uptrend = close > ema200
is_eth_downtrend = close < ema200
is_btc_healthy = btc_close > btc_ema50

// BTC filtresi kontrolÃ¼ (aktifse BTC saÄŸlÄ±klÄ± olmalÄ±, deÄŸilse her zaman geÃ§erli)
btc_filter_passed = not enable_btc_filter or is_btc_healthy

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ SÄ°NYAL KOÅULLARI â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// === ALIÅ SÄ°NYALLERÄ° ===

// 1. Trend Ä°Ã§i DÃ¼zeltme AlÄ±mÄ±
// KoÅŸul: ETH > EMA200 VE RSI < 40 VE BTC > EMA50
trend_buy_signal = is_eth_uptrend and rsi < rsi_trend_entry and rsi[1] >= rsi_trend_entry and btc_filter_passed

// 2. Dip AvcÄ±sÄ± AlÄ±mÄ± (Riskli)
// KoÅŸul: RSI < 28 (BTC filtresi opsiyonel)
dip_buy_signal = enable_dip_hunter and rsi < rsi_dip_entry and rsi[1] >= rsi_dip_entry and is_eth_downtrend

// === SATIÅ SÄ°NYALLERÄ° ===

// 1. KÄ±smi SatÄ±ÅŸ: RSI >= 75
partial_sell_signal = rsi >= rsi_overbought and rsi[1] < rsi_overbought

// 2. Tam Ã‡Ä±kÄ±ÅŸ: Fiyat EMA20 altÄ±nda kapanÄ±ÅŸ
full_exit_signal = close < ema20 and close[1] >= ema20

// === UYARI SÄ°NYALLERÄ° ===

// BTC riskli durumda uyarÄ± (ETH teknik olarak uygun ama BTC zayÄ±f)
btc_warning = is_eth_uptrend and rsi < rsi_trend_entry and not is_btc_healthy and enable_btc_filter

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ STRATEJÄ° UYGULAMASI â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var bool in_position = false
var bool partial_sold = false
var string entry_type = ""

// AlÄ±ÅŸ emirleri
if trend_buy_signal and not in_position
    strategy.entry("Trend AlÄ±m", strategy.long)
    in_position := true
    partial_sold := false
    entry_type := "TREND"

if dip_buy_signal and not in_position
    strategy.entry("Dip AlÄ±m", strategy.long)
    in_position := true
    partial_sold := false
    entry_type := "DIP"

// KÄ±smi satÄ±ÅŸ
if partial_sell_signal and in_position and not partial_sold
    strategy.close("Trend AlÄ±m", qty_percent=partial_exit_pct, comment="RSI KÄ±smi SatÄ±ÅŸ")
    strategy.close("Dip AlÄ±m", qty_percent=partial_exit_pct, comment="RSI KÄ±smi SatÄ±ÅŸ")
    partial_sold := true

// Tam Ã§Ä±kÄ±ÅŸ
if full_exit_signal and in_position
    strategy.close_all(comment="EMA20 Ã‡Ä±kÄ±ÅŸ")
    in_position := false
    partial_sold := false
    entry_type := ""

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ GÃ–RSELLEÅTÄ°RME â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// EMA Ã‡izgileri
plot(show_ema200 ? ema200 : na, "EMA 200", color=color.purple, linewidth=2)
plot(show_ema20 ? ema20 : na, "EMA 20", color=color.blue, linewidth=1)

// Trend Arka Plan
bgcolor(is_eth_uptrend ? color.new(color.green, 95) : color.new(color.red, 95))

// BTC UyarÄ± Arka PlanÄ± (BTC zayÄ±fken)
bgcolor(btc_warning ? color.new(color.yellow, 85) : na)

// AlÄ±m Sinyalleri
plotshape(trend_buy_signal, "Trend AlÄ±m", shape.triangleup, location.belowbar,
     color=color.green, size=size.normal, text="TREND\nAL")
plotshape(dip_buy_signal, "Dip AlÄ±m", shape.triangleup, location.belowbar,
     color=color.lime, size=size.normal, text="DÄ°P\nAL")

// BTC UyarÄ± (teknik uygun ama BTC zayÄ±f)
plotshape(btc_warning, "BTC UyarÄ±", shape.xcross, location.abovebar,
     color=color.yellow, size=size.small, text="BTC\nRÄ°SK")

// SatÄ±ÅŸ Sinyalleri
plotshape(partial_sell_signal, "KÄ±smi SatÄ±ÅŸ", shape.triangledown, location.abovebar,
     color=color.orange, size=size.small, text="%50\nSAT")
plotshape(full_exit_signal, "Tam Ã‡Ä±kÄ±ÅŸ", shape.triangledown, location.abovebar,
     color=color.red, size=size.normal, text="Ã‡IKIÅ")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ BÄ°LGÄ° PANELÄ° â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table info_panel = table.new(position.top_right, 2, 8, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast
    // ETH Durumu
    eth_trend_text = is_eth_uptrend ? "ğŸŸ¢ YÃœKSELIÅ" : "ğŸ”´ DÃœÅÃœÅ"
    eth_trend_color = is_eth_uptrend ? color.green : color.red

    // BTC Durumu
    btc_status_text = is_btc_healthy ? "ğŸŸ¢ SAÄLIKLI" : "ğŸŸ¡ RÄ°SKLÄ°"
    btc_status_color = is_btc_healthy ? color.green : color.yellow

    // RSI Rengi
    rsi_color = rsi < 28 ? color.lime : rsi < 40 ? color.green : rsi > 75 ? color.red : color.gray

    // Panel BaÅŸlÄ±klarÄ±
    table.cell(info_panel, 0, 0, "ETH SWING", text_color=color.purple, text_size=size.normal)
    table.cell(info_panel, 1, 0, "STRATEJÄ°", text_color=color.purple, text_size=size.normal)

    // ETH Bilgileri
    table.cell(info_panel, 0, 1, "ETH Trend:", text_color=color.white, text_size=size.small)
    table.cell(info_panel, 1, 1, eth_trend_text, text_color=eth_trend_color, text_size=size.small)

    table.cell(info_panel, 0, 2, "RSI (14):", text_color=color.white, text_size=size.small)
    table.cell(info_panel, 1, 2, str.tostring(rsi, "#.##"), text_color=rsi_color, text_size=size.small)

    table.cell(info_panel, 0, 3, "EMA 200:", text_color=color.white, text_size=size.small)
    table.cell(info_panel, 1, 3, str.tostring(ema200, "#.##"), text_color=color.purple, text_size=size.small)

    // BTC Korelasyon
    table.cell(info_panel, 0, 4, "â”â”â”â”â”â”", text_color=color.gray, text_size=size.small)
    table.cell(info_panel, 1, 4, "â”â”â”â”â”â”", text_color=color.gray, text_size=size.small)

    table.cell(info_panel, 0, 5, "BTC Durum:", text_color=color.white, text_size=size.small)
    table.cell(info_panel, 1, 5, btc_status_text, text_color=btc_status_color, text_size=size.small)

    table.cell(info_panel, 0, 6, "BTC/EMA50:", text_color=color.white, text_size=size.small)
    btc_vs_ema = ((btc_close - btc_ema50) / btc_ema50) * 100
    table.cell(info_panel, 1, 6, str.tostring(btc_vs_ema, "#.##") + "%", text_color=btc_vs_ema > 0 ? color.green : color.red, text_size=size.small)

    // Sinyal Durumu
    signal_text = trend_buy_signal ? "ğŸ“ˆ TREND ALIM!" : dip_buy_signal ? "ğŸ¯ DÄ°P ALIM!" : btc_warning ? "âš ï¸ BTC RÄ°SKLÄ°" : partial_sell_signal ? "âš ï¸ KISMI SAT" : full_exit_signal ? "ğŸšª Ã‡IKIÅ" : "â³ BEKLÄ°YOR"
    signal_color = trend_buy_signal or dip_buy_signal ? color.green : btc_warning ? color.yellow : partial_sell_signal or full_exit_signal ? color.red : color.gray

    table.cell(info_panel, 0, 7, "Sinyal:", text_color=color.white, text_size=size.small)
    table.cell(info_panel, 1, 7, signal_text, text_color=signal_color, text_size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆ ALARMLAR â–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// NOT: alertcondition sadece sabit string kabul eder, dinamik RSI deÄŸeri kullanÄ±lamaz
// {{close}}, {{ticker}}, {{time}}, {{exchange}} gibi TradingView placeholder'larÄ± kullanÄ±labilir

alertcondition(trend_buy_signal, title="ETH Trend Ä°Ã§i AlÄ±m", message="ğŸŸ¢ ETH TREND ALIM SÄ°NYALÄ°!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nKoÅŸul: RSI < 40 ve Fiyat > EMA200 ve BTC SaÄŸlÄ±klÄ±\n\nâœ… GÃ¼Ã§lÃ¼ alÄ±m fÄ±rsatÄ±!")

alertcondition(dip_buy_signal, title="ETH Dip AvcÄ±sÄ± AlÄ±m", message="ğŸ¯ ETH DÄ°P ALIM SÄ°NYALÄ°!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nKoÅŸul: RSI < 28 (AÅŸÄ±rÄ± SatÄ±m)\n\nâš ï¸ Volatil piyasa - Kademeli al!")

alertcondition(btc_warning, title="ETH BTC Risk UyarÄ±sÄ±", message="ğŸŸ¡ ETH TEKNÄ°K UYGUN AMA BTC RÄ°SKLÄ°!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nETH RSI uygun ancak BTC EMA50 altÄ±nda.\n\nâš ï¸ Piyasa riskli - Dikkatli ol!")

alertcondition(partial_sell_signal, title="ETH KÄ±smi SatÄ±ÅŸ", message="ğŸŸ  ETH KISMI SATIÅ!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nKoÅŸul: RSI >= 75 (AÅŸÄ±rÄ± AlÄ±m)\n\nğŸ’° Pozisyonun %50'sini sat!")

alertcondition(full_exit_signal, title="ETH Tam Ã‡Ä±kÄ±ÅŸ", message="ğŸ”´ ETH TAM Ã‡IKIÅ!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nKoÅŸul: EMA20 altÄ±nda kapanÄ±ÅŸ\n\nğŸšª TÃ¼m pozisyonu kapat!")

// Kombine alarm
any_signal = trend_buy_signal or dip_buy_signal or partial_sell_signal or full_exit_signal or btc_warning
alertcondition(any_signal, title="ETH TÃ¼m Sinyaller", message="ğŸ“Š ETH SÄ°NYAL ALGILANDI!\n\nSembol: {{ticker}}\nFiyat: {{close}}\nZaman: {{time}}\n\nDetaylar iÃ§in grafiÄŸi kontrol et.")
