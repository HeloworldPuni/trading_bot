//@version=5
indicator("ðŸ’Ž Explosive Penny Stock Hunter", overlay=true, max_labels_count=100)

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROFESSIONAL SETTINGS - 30%+ MOVES ONLY
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Volume Requirements (STRICT)
minVolMultiplier = input.float(4.0, "Minimum Volume Surge", minval=2.0, maxval=10.0, step=0.5,
     tooltip="Kamida 4x volume kerak")
extremeVolThreshold = input.float(8.0, "Extreme Volume Level", minval=5.0, maxval=15.0)

// Price Action (STRICT - 30%+ potential detection)
minBreakoutPercent = input.float(3.0, "Min Breakout %", minval=1.0, maxval=8.0, step=0.5,
     tooltip="Konsolidatsiyadan qancha % yuqori yopilishi kerak")
minMomentumBars = input.int(5, "Momentum Bars", minval=3, maxval=10)

// Pattern Recognition
consolidationBars = input.int(15, "Consolidation Period", minval=10, maxval=30,
     tooltip="Uzunroq consolidation = kuchliroq breakout")
maxConsolidationRange = input.float(6.0, "Max Range %", minval=3.0, maxval=10.0)

// Signal Filters (ANTI-SPAM)
signalCooldown = input.int(15, "Signal Cooldown Bars", minval=10, maxval=30,
     tooltip="Signallar orasida minimal 15 bar")
minMoveForNewSignal = input.float(8.0, "Min Move for New Signal %", minval=5.0, maxval=15.0)

// Risk Management
riskRewardRatio = input.float(3.0, "Risk:Reward Ratio", minval=2.0, maxval=5.0, step=0.5)
stopLossPercent = input.float(3.0, "Stop Loss %", minval=1.5, maxval=5.0, step=0.5)

// Display
showSetupSignals = input.bool(false, "Show Setup Signals", tooltip="Faqat strong buy'larni ko'rsatish")
showStopLoss = input.bool(true, "Show Stop Loss Levels")
showTakeProfit = input.bool(true, "Show Take Profit Levels")

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CORE CALCULATIONS
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Volume Analysis
avgVol = ta.sma(volume, 20)
volRatio = avgVol > 0 ? volume / avgVol : 0
volSurge = volRatio >= minVolMultiplier
extremeVol = volRatio >= extremeVolThreshold

// Volume Trend (Accelerating?)
volMA3 = ta.sma(volume, 3)
volMA10 = ta.sma(volume, 10)
volAccel = volMA3 > volMA10 * 1.5

// Price Structure
highestHigh = ta.highest(high, consolidationBars)
lowestLow = ta.lowest(low, consolidationBars)
consolidationMid = (highestHigh + lowestLow) / 2
consolidationRange = highestHigh - lowestLow
rangePercent = consolidationMid > 0 ? (consolidationRange / consolidationMid * 100) : 0

// Tight Consolidation (Spring loading)
tightConsolidation = rangePercent < maxConsolidationRange and rangePercent > 1.0
breakoutLevel = highestHigh * (1 + minBreakoutPercent/100)
cleanBreakout = close > breakoutLevel and high > breakoutLevel

// Momentum Detection
momentum5 = (close - close[minMomentumBars]) / close[minMomentumBars] * 100
momentum10 = (close - close[10]) / close[10] * 100
strongMomentum = momentum5 > 5.0 and close > open

// Consecutive Strength
consecutive = close > open and close[1] > open[1] and close[2] > open[2]
strongCandle = (close - open) / (high - low) > 0.7 and close > open

// RSI (Optimized)
rsi = ta.rsi(close, 14)
rsiNotOverbought = rsi < 75
rsiBounce = rsi > rsi[2] and rsi[2] < rsi[4]

// Moving Averages
ema8 = ta.ema(close, 8)
ema21 = ta.ema(close, 21)
sma50 = ta.sma(close, 50)

priceAboveEMA = close > ema8 and ema8 > ema21
goldenCross = ta.crossover(ema8, ema21)

// VWAP
vwapValue = ta.vwap(close)
priceAboveVWAP = close > vwapValue

// Pump Detection (CRITICAL - avoid late entries)
priceNearHigh = close > highestHigh * 0.95 // If price near recent high
volumeDeclining = volume < volume[1] and volume[1] < volume[2]
possiblePumpTop = priceNearHigh and volumeDeclining and rsi > 70

// NOT in pullback
notPullback = close > close[2] and low > low[3]

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPLOSIVE PATTERN DETECTION
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Pattern 1: Tight Consolidation Breakout (30%+ potential)
pattern1 = tightConsolidation and cleanBreakout and volSurge and 
           strongCandle and priceAboveEMA and rsiNotOverbought

// Pattern 2: Volume Explosion from Base (50%+ potential)
pattern2 = extremeVol and momentum5 > 8.0 and consecutive and 
           close > highestHigh[1] and priceAboveVWAP and not possiblePumpTop

// Pattern 3: Gap and Go (100%+ potential)
gapPercent = open > close[1] ? (open - close[1]) / close[1] * 100 : 0
gapUp = gapPercent > 5.0
pattern3 = gapUp and volSurge and strongMomentum and close > open and rsiNotOverbought

// Pattern 4: Golden Cross + Volume (40%+ potential)
pattern4 = goldenCross and extremeVol and strongMomentum and 
           notPullback and rsiNotOverbought

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SIGNAL FILTERING SYSTEM
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Track last signals
var int lastSignalBar = 0
var float lastSignalPrice = 0.0
var float lastSignalStop = 0.0
var float lastSignalTP1 = 0.0
var float lastSignalTP2 = 0.0

barsSinceSignal = bar_index - lastSignalBar
moveFromLastSignal = lastSignalPrice > 0 ? (close - lastSignalPrice) / lastSignalPrice * 100 : 999

// Cooldown logic
cooldownActive = barsSinceSignal < signalCooldown
significantNewMove = moveFromLastSignal > minMoveForNewSignal or moveFromLastSignal == 999

// Raw signal (before filters)
rawSignal = (pattern1 or pattern2 or pattern3 or pattern4) and not possiblePumpTop

// FINAL SIGNAL (with all filters)
explosiveSignal = rawSignal and volSurge and rsiNotOverbought and notPullback and
                  (not cooldownActive or significantNewMove) and not possiblePumpTop

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RISK MANAGEMENT CALCULATIONS
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Stop Loss: Below recent consolidation or 3% below entry
stopLossLevel = explosiveSignal ? math.min(lowestLow, close * (1 - stopLossPercent/100)) : na
stopLossDistance = explosiveSignal ? (close - stopLossLevel) / close * 100 : na

// Take Profit Levels
tp1Distance = stopLossDistance * riskRewardRatio
tp2Distance = stopLossDistance * (riskRewardRatio * 2)

takeProfit1 = explosiveSignal ? close * (1 + tp1Distance/100) : na
takeProfit2 = explosiveSignal ? close * (1 + tp2Distance/100) : na

// Pattern-specific TP adjustments
if explosiveSignal
    if pattern1
        takeProfit1 := close * 1.25  // 25% TP1
        takeProfit2 := close * 1.50  // 50% TP2
    else if pattern2
        takeProfit1 := close * 1.35  // 35% TP1
        takeProfit2 := close * 1.70  // 70% TP2
    else if pattern3
        takeProfit1 := close * 1.50  // 50% TP1
        takeProfit2 := close * 2.00  // 100% TP2
    else if pattern4
        takeProfit1 := close * 1.30  // 30% TP1
        takeProfit2 := close * 1.60  // 60% TP2

// Update tracking
if explosiveSignal
    lastSignalBar := bar_index
    lastSignalPrice := close
    lastSignalStop := stopLossLevel
    lastSignalTP1 := takeProfit1
    lastSignalTP2 := takeProfit2

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VISUALIZATION - CLEAN & PROFESSIONAL
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Subtle background zones
bgcolor(tightConsolidation and volAccel ? color.new(color.blue, 97) : na, title="Setup Building")
bgcolor(explosiveSignal ? color.new(color.green, 93) : na, title="Signal Zone")
bgcolor(possiblePumpTop ? color.new(color.red, 96) : na, title="Danger Zone")

// Signal Label (Clean, small)
if explosiveSignal
    patternName = pattern3 ? "GAP" : pattern2 ? "EXPL" : pattern1 ? "BRK" : "GOLD"
    potentialGain = ((takeProfit2 - close) / close * 100)
    
    labelText = "ðŸš€ " + patternName + "\n" + str.tostring(math.round(potentialGain)) + "%"
    
    label.new(bar_index, low, 
         text=labelText, 
         style=label.style_label_up, 
         color=color.new(color.green, 20), 
         textcolor=color.white, 
         size=size.small,
         tooltip="Entry: $" + str.tostring(close, "#.###") + 
                 "\nStop: $" + str.tostring(stopLossLevel, "#.###") +
                 "\nTP1: $" + str.tostring(takeProfit1, "#.###") +
                 "\nTP2: $" + str.tostring(takeProfit2, "#.###") +
                 "\nVolume: " + str.tostring(math.round(volRatio, 1)) + "x")
    
    // Alert
    alert("ðŸš€ EXPLOSIVE BUY: " + syminfo.ticker + 
          "\nðŸ“Š Pattern: " + patternName +
          "\nðŸ’° Entry: $" + str.tostring(close, "#.####") +
          "\nðŸ›‘ Stop Loss: $" + str.tostring(stopLossLevel, "#.####") + " (-" + str.tostring(math.round(stopLossDistance, 1)) + "%)" +
          "\nðŸŽ¯ TP1: $" + str.tostring(takeProfit1, "#.####") + " (+" + str.tostring(math.round(tp1Distance, 1)) + "%)" +
          "\nðŸŽ¯ TP2: $" + str.tostring(takeProfit2, "#.####") + " (+" + str.tostring(math.round(tp2Distance, 1)) + "%)" +
          "\nðŸ“ˆ Volume: " + str.tostring(math.round(volRatio, 1)) + "x" +
          "\nâš¡ Potential: +" + str.tostring(math.round(potentialGain)) + "%", 
          alert.freq_once_per_bar)

// Stop Loss Line (Semi-transparent red)
var line slLine = na
if explosiveSignal and showStopLoss
    slLine := line.new(bar_index, stopLossLevel, bar_index + 10, stopLossLevel, 
                       color=color.new(color.red, 40), width=1, style=line.style_dashed)
    label.new(bar_index + 5, stopLossLevel, "SL", 
              style=label.style_none, color=color.new(color.red, 70), 
              textcolor=color.red, size=size.tiny)

// Take Profit Lines (Semi-transparent green)
var line tp1Line = na
var line tp2Line = na

if explosiveSignal and showTakeProfit
    tp1Line := line.new(bar_index, takeProfit1, bar_index + 10, takeProfit1, 
                        color=color.new(color.lime, 50), width=1, style=line.style_dashed)
    label.new(bar_index + 5, takeProfit1, "TP1", 
              style=label.style_none, color=color.new(color.lime, 70), 
              textcolor=color.lime, size=size.tiny)
    
    tp2Line := line.new(bar_index, takeProfit2, bar_index + 10, takeProfit2, 
                        color=color.new(color.lime, 50), width=1, style=line.style_dashed)
    label.new(bar_index + 5, takeProfit2, "TP2", 
              style=label.style_none, color=color.new(color.lime, 70), 
              textcolor=color.lime, size=size.tiny)

// Key EMAs (Subtle)
plot(ema8, "EMA 8", color=color.new(color.yellow, 70), linewidth=1)
plot(ema21, "EMA 21", color=color.new(color.orange, 70), linewidth=1)
plot(vwapValue, "VWAP", color=color.new(color.blue, 80), linewidth=1, style=plot.style_circles)

// Consolidation Box (When forming)
var box consBox = na
if tightConsolidation and volAccel and bar_index % 5 == 0
    consBox := box.new(bar_index - consolidationBars, highestHigh, bar_index, lowestLow, 
                       border_color=color.new(color.purple, 60), bgcolor=color.new(color.purple, 95),
                       border_width=1, border_style=line.style_dashed)

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMPACT DASHBOARD
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table dash = table.new(position.top_right, 2, 8, 
     bgcolor=color.new(color.black, 15), 
     frame_color=color.new(color.gray, 70), 
     frame_width=1,
     border_color=color.new(color.gray, 80),
     border_width=1)

if barstate.islast
    // Header
    table.cell(dash, 0, 0, "METRIC", text_color=color.gray, 
         bgcolor=color.new(color.black, 30), text_size=size.tiny)
    table.cell(dash, 1, 0, "VALUE", text_color=color.gray, 
         bgcolor=color.new(color.black, 30), text_size=size.tiny)
    
    // Status
    statusText = explosiveSignal ? "ðŸš€ BUY" : 
                 cooldownActive ? "â¸ COOLDOWN" :
                 tightConsolidation and volAccel ? "âš¡ LOADING" : "â¸ WAIT"
    statusColor = explosiveSignal ? color.lime : 
                  cooldownActive ? color.orange :
                  tightConsolidation and volAccel ? color.yellow : color.gray
    
    table.cell(dash, 0, 1, "Status", text_color=color.silver, text_size=size.small)
    table.cell(dash, 1, 1, statusText, text_color=statusColor, text_size=size.small)
    
    // Volume
    table.cell(dash, 0, 2, "Volume", text_color=color.silver, text_size=size.tiny)
    volColor = extremeVol ? color.lime : volSurge ? color.yellow : color.gray
    table.cell(dash, 1, 2, str.tostring(math.round(volRatio, 1)) + "x", 
         text_color=volColor, text_size=size.tiny)
    
    // RSI
    table.cell(dash, 0, 3, "RSI", text_color=color.silver, text_size=size.tiny)
    rsiColor = rsi > 70 ? color.red : rsi < 40 ? color.lime : color.gray
    table.cell(dash, 1, 3, str.tostring(math.round(rsi)), text_color=rsiColor, text_size=size.tiny)
    
    // Pattern
    table.cell(dash, 0, 4, "Pattern", text_color=color.silver, text_size=size.tiny)
    patternText = pattern3 ? "GAP" : pattern2 ? "EXPLOSION" : 
                  pattern1 ? "BREAKOUT" : pattern4 ? "GOLDEN X" : "None"
    patternColor = (pattern1 or pattern2 or pattern3 or pattern4) ? color.aqua : color.gray
    table.cell(dash, 1, 4, patternText, text_color=patternColor, text_size=size.tiny)
    
    // Base Quality
    table.cell(dash, 0, 5, "Base", text_color=color.silver, text_size=size.tiny)
    baseText = tightConsolidation ? "TIGHT âœ“" : "WIDE"
    baseColor = tightConsolidation ? color.lime : color.gray
    table.cell(dash, 1, 5, baseText, text_color=baseColor, text_size=size.tiny)
    
    // Pump Warning
    table.cell(dash, 0, 6, "Pump Risk", text_color=color.silver, text_size=size.tiny)
    pumpText = possiblePumpTop ? "HIGH âš " : "LOW âœ“"
    pumpColor = possiblePumpTop ? color.red : color.lime
    table.cell(dash, 1, 6, pumpText, text_color=pumpColor, text_size=size.tiny)
    
    // Cooldown Info
    if cooldownActive
        table.cell(dash, 0, 7, "Cooldown", text_color=color.silver, text_size=size.tiny)
        table.cell(dash, 1, 7, str.tostring(signalCooldown - barsSinceSignal) + " bars", 
             text_color=color.orange, text_size=size.tiny)

// Volume bars (Subtle coloring)
barcolor(extremeVol ? color.new(color.yellow, 40) : 
         volSurge ? color.new(color.aqua, 60) : na)