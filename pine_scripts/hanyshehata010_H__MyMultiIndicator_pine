//@version=5
indicator("My Multi-Indicator", shorttitle="MultiIndi", overlay=true)

// User Inputs
// RSI Settings
rsiLen = input.int(14, title="RSI Length", minval=1, group="RSI Settings", tooltip="Length for RSI calculation.")
rsiSource = input.source(close, title="RSI Source", group="RSI Settings", tooltip="Source price for RSI.")
rsiOB = input.int(70, "RSI Overbought", group="RSI Settings", tooltip="Overbought level for RSI.")
rsiOS = input.int(30, "RSI Oversold", group="RSI Settings", tooltip="Oversold level for RSI.")

// MACD Settings
macdFastLen = input.int(12, title="MACD Fast Length", minval=1, group="MACD Settings", tooltip="Fast EMA length for MACD.")
macdSlowLen = input.int(26, title="MACD Slow Length", minval=1, group="MACD Settings", tooltip="Slow EMA length for MACD.")
macdSigLen = input.int(9, title="MACD Signal Length", minval=1, group="MACD Settings", tooltip="Signal line EMA length for MACD.")
macdSource = input.source(close, title="MACD Source", group="MACD Settings", tooltip="Source price for MACD.")

// Bollinger Bands Settings
bbLen = input.int(20, title="BB Length", minval=1, group="Bollinger Bands Settings", tooltip="Length for Bollinger Bands calculation.")
bbMult = input.float(2.0, title="BB StdDev Multiplier", minval=0.1, group="Bollinger Bands Settings", tooltip="Standard Deviation multiplier for BB.")
bbSource = input.source(close, title="BB Source", group="Bollinger Bands Settings", tooltip="Source price for Bollinger Bands.")

// Stochastic Oscillator Settings
stochLen = input.int(14, title="Stochastic Length (%K)", minval=1, group="Stochastic Settings", tooltip="Length for %K calculation.")
stochSmoothK = input.int(3, title="Stochastic %K Smoothing", minval=1, group="Stochastic Settings", tooltip="Smoothing for %K to create %D.")
stochSmoothD = input.int(3, title="Stochastic %D Smoothing", minval=1, group="Stochastic Settings", tooltip="Smoothing for %D (for Slow Stochastic). Not used in standard %D.")
stochSource = input.source(close, title="Stochastic Source", group="Stochastic Settings", tooltip="This is the 'close' for ta.stoch. High and Low are taken from chart.")
stochOB = input.int(80, "Stoch Overbought", group="Stochastic Settings", tooltip="Overbought level for Stochastic.")
stochOS = input.int(20, "Stoch Oversold", group="Stochastic Settings", tooltip="Oversold level for Stochastic.")

// ADX Settings
adxLen = input.int(14, title="ADX Smoothing Length", minval=1, group="ADX Settings", tooltip="Smoothing length for ADX/DI calculation.")
adxTrendLevel = input.int(25, "ADX Trend Level", group="ADX Settings", tooltip="Level to indicate a strong trend.")
adxWeakLevel = input.int(20, "ADX Weak Level", group="ADX Settings", tooltip="Level to indicate a weak trend or no trend.")

// VWAP Settings
vwapSource = input.source(hlc3, title="VWAP Source", group="VWAP Settings", tooltip="Source for VWAP calculation (e.g., hlc3, close).")

// 1. Relative Strength Index (RSI)
rsiValue = ta.rsi(rsiSource, rsiLen)

// 2. Moving Average Convergence Divergence (MACD)
[macdLine, signalLine, histLine] = ta.macd(macdSource, macdFastLen, macdSlowLen, macdSigLen)

// 3. Bollinger Bands (BB)
[middleBB, upperBB, lowerBB] = ta.bb(bbSource, bbLen, bbMult)

// 4. Stochastic Oscillator
k = ta.stoch(stochSource, high, low, stochLen) // Using stochSource for the 'close' argument
d = ta.sma(k, stochSmoothK) // Standard %D calculation

// 5. Average Directional Index (ADX)
[adxValue, diPlus, diMinus] = ta.adx(high, low, close, adxLen) // 'close' is implicit for ADX source along with high/low

// 6. Volume Weighted Average Price (VWAP)
vwapValue = ta.vwap(vwapSource)

// Determine Interpretations and Normal Ranges

// 1. RSI
rsiInterpretation = ""
if rsiValue > rsiOB
    rsiInterpretation := "Overbought"
else if rsiValue < rsiOS
    rsiInterpretation := "Oversold"
else
    rsiInterpretation := "Neutral"
rsiNormalRange = str.tostring(rsiOS) + "-" + str.tostring(rsiOB)

// 2. MACD
macdInterpretation = ""
if macdLine > signalLine and histLine > 0
    macdInterpretation := "Bullish"
else if macdLine < signalLine and histLine < 0
    macdInterpretation := "Bearish"
else
    macdInterpretation := "Neutral"
macdNormalRange = "N/A" // MACD range is not typically defined by fixed levels

// 3. Bollinger Bands
bbInterpretation = ""
if bbSource > upperBB // Compare bbSource (or close if preferred) with bands
    bbInterpretation := "Price High"
else if bbSource < lowerBB
    bbInterpretation := "Price Low"
else
    bbInterpretation := "In Bands"
bbNormalRange = "Between Bands"

// 4. Stochastic Oscillator
stochInterpretation = ""
if k > stochOB and d > stochOB
    stochInterpretation := "Overbought"
else if k < stochOS and d < stochOS
    stochInterpretation := "Oversold"
else
    stochInterpretation := "Neutral"
stochNormalRange = str.tostring(stochOS) + "-" + str.tostring(stochOB)

// 5. ADX
adxInterpretation = ""
if adxValue > adxTrendLevel and diPlus > diMinus
    adxInterpretation := "Strong Bullish"
else if adxValue > adxTrendLevel and diMinus > diPlus
    adxInterpretation := "Strong Bearish"
else if adxValue < adxWeakLevel
    adxInterpretation := "Weak Trend"
else
    adxInterpretation := "Developing Trend"
adxNormalRange = "ADX>" + str.tostring(adxTrendLevel) + " Strong, <" + str.tostring(adxWeakLevel) + " Weak"

// 6. VWAP
vwapInterpretation = ""
if close > vwapValue // Using 'close' for comparison with VWAP
    vwapInterpretation := "Above VWAP"
else if close < vwapValue
    vwapInterpretation := "Below VWAP"
else
    vwapInterpretation := "At VWAP"
vwapNormalRange = "N/A"

// Display Panel Table
if barstate.islast
    var table panel = table.new(position.top_right, 4, 7, border_width=1)

    f_cell(_table, _column, _row, _text, _bgcolor, _textcolor) =>
        table.cell(_table, _column, _row, _text, bgcolor=_bgcolor, text_color=_textcolor, text_size=size.small)

    f_cell(panel, 0, 0, "Indicator", color.gray, color.white)
    f_cell(panel, 1, 0, "Value", color.gray, color.white)
    f_cell(panel, 2, 0, "Signal", color.gray, color.white)
    f_cell(panel, 3, 0, "Range", color.gray, color.white)

    // 1. RSI Data
    f_cell(panel, 0, 1, "RSI (" + str.tostring(rsiLen) + ")", color.black, color.white)
    f_cell(panel, 1, 1, str.tostring(rsiValue, "#.##"), color.black, color.white)
    f_cell(panel, 2, 1, rsiInterpretation, color.black, color.white)
    f_cell(panel, 3, 1, rsiNormalRange, color.black, color.white)

    // 2. MACD Data
    f_cell(panel, 0, 2, "MACD (" + str.tostring(macdFastLen) + "," + str.tostring(macdSlowLen) + "," + str.tostring(macdSigLen) + ")", color.black, color.white)
    f_cell(panel, 1, 2, "L:" + str.tostring(macdLine, "#.##") + " S:" + str.tostring(signalLine, "#.##") + " H:" + str.tostring(histLine, "#.##"), color.black, color.white)
    f_cell(panel, 2, 2, macdInterpretation, color.black, color.white)
    f_cell(panel, 3, 2, macdNormalRange, color.black, color.white)

    // 3. Bollinger Bands Data
    f_cell(panel, 0, 3, "BB (" + str.tostring(bbLen) + "," + str.tostring(bbMult, "#.#") + ")", color.black, color.white)
    f_cell(panel, 1, 3, "U:" + str.tostring(upperBB, "#.##") + " M:" + str.tostring(middleBB, "#.##") + " L:" + str.tostring(lowerBB, "#.##"), color.black, color.white)
    f_cell(panel, 2, 3, bbInterpretation, color.black, color.white)
    f_cell(panel, 3, 3, bbNormalRange, color.black, color.white)

    // 4. Stochastic Data
    f_cell(panel, 0, 4, "Stoch (" + str.tostring(stochLen) + "," + str.tostring(stochSmoothK) + ")", color.black, color.white) // Standard D uses stochSmoothK
    f_cell(panel, 1, 4, "K:" + str.tostring(k, "#.##") + " D:" + str.tostring(d, "#.##"), color.black, color.white)
    f_cell(panel, 2, 4, stochInterpretation, color.black, color.white)
    f_cell(panel, 3, 4, stochNormalRange, color.black, color.white)

    // 5. ADX Data
    f_cell(panel, 0, 5, "ADX (" + str.tostring(adxLen) + ")", color.black, color.white)
    f_cell(panel, 1, 5, "ADX:" + str.tostring(adxValue, "#.##") + " +DI:" + str.tostring(diPlus, "#.##") + " -DI:" + str.tostring(diMinus, "#.##"), color.black, color.white)
    f_cell(panel, 2, 5, adxInterpretation, color.black, color.white)
    f_cell(panel, 3, 5, adxNormalRange, color.black, color.white)

    // 6. VWAP Data
    f_cell(panel, 0, 6, "VWAP", color.black, color.white) // VWAP source displayed in settings
    f_cell(panel, 1, 6, str.tostring(vwapValue, "#.##"), color.black, color.white)
    f_cell(panel, 2, 6, vwapInterpretation, color.black, color.white)
    f_cell(panel, 3, 6, vwapNormalRange, color.black, color.white)

// Plotting Indicators

// 1. RSI
plot(rsiValue, "RSI", color=color.new(color.purple, 0))
hline(rsiOB, "RSI OB", color.gray)
hline(rsiOS, "RSI OS", color.gray)

// 2. MACD
plot(macdLine, "MACD Line", color=color.new(color.blue, 0))
plot(signalLine, "Signal Line", color=color.new(color.orange, 0))
plot(histLine, "MACD Hist", color=color.new(color.red, 50), style=plot.style_histogram)

// 3. Bollinger Bands
bbMiddlePlot = plot(middleBB, "BB Middle", color=color.new(color.gray, 0))
bbUpperPlot = plot(upperBB, "BB Upper", color=color.new(color.teal, 0))
bbLowerPlot = plot(lowerBB, "BB Lower", color=color.new(color.teal, 0))
fill(bbUpperPlot, bbLowerPlot, color=color.new(color.teal, 90), title="BB Fill")

// 4. Stochastic Oscillator
plot(k, "%K", color=color.new(color.green, 0))
plot(d, "%D", color=color.new(color.lime, 0))
hline(stochOB, "Stoch OB", color.gray)
hline(stochOS, "Stoch OS", color.gray)

// 5. ADX
plot(adxValue, "ADX", color=color.new(color.maroon, 0))
plot(diPlus, "+DI", color=color.new(color.green, 50))
plot(diMinus, "-DI", color=color.new(color.red, 50))
hline(adxTrendLevel, "ADX Trend", color.gray)

// 6. VWAP
plot(vwapValue, "VWAP", color=color.new(color.blue, 0), linewidth=2)
